services:
- mysql

variables:
  MYSQL_DATABASE: Cover_Me
  MYSQL_ROOT_PASSWORD: 4200
  MYSQL_HOST: localhost

connect:
  image: mysql
  script:
  - echo "SELECT 'OK';" | mysql --user=root --password="$MYSQL_ROOT_PASSWORD" --host="$MYSQL_HOST" "$MYSQL_DATABASE"

stages: 
  ['test','deliver']
test:
  image: python:3.7
  stage: test
  only:
    ['develop']
  when:
    on_success
  script: 
    - pip install pytest
    - pip install pytest-dependency
    - pip install bcrypt
    - pip install mysql-connector-python
    - pytest src/test_rs.py --verbose --color=yes
    - pytest src/test_login_register.py --verbose --color=yes

